plugins {
    id "org.jetbrains.intellij" version "0.4.5"
}

repositories {
    mavenCentral()
    mavenLocal()
    maven {
        url 'https://repo.spring.io/libs-snapshot/'
    }
}

intellij {
    //version '2018.3'
    plugins = ['IntelliLang', 'java']
    pluginName 'idea-boot-java'
    downloadSources = false
    localPath '/opt/ideaIC-2019'
}

patchPluginXml {
    untilBuild '193.*'
    sinceBuild '183.3647.12'
}

dependencies {
    compile 'org.wso2.lsp4intellij:lsp4intellij:8.0.1-SNAPSHOT'
    compile 'org.springframework.ide.vscode:commons-java:1.10.0-20190809.091424-31'
}

sourceSets {
    main {
        java {
            srcDirs = ['src']
        }
        resources {
            srcDirs = ['resources']
        }
    }
}

prepareSandbox.doLast {
    def pluginServerDir = "${intellij.sandboxDirectory}/plugins/idea-boot-java/lib/server/language-server.jar"

    mkdir(pluginServerDir)
    copy {
        from("$project.projectDir/server/language-server.jar")
        into(pluginServerDir)
    }
}

publishPlugin.doFirst {
    def pluginServerDir = "${intellij.sandboxDirectory}/plugins/idea-boot-java/lib/server/language-server.jar"
    delete(pluginServerDir)    
}

